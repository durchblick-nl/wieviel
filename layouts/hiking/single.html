<!DOCTYPE html>
<html lang="{{ .Language.Lang }}">
<head>
    {{ partial "head.html" . }}
    <style>
        .result-box {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            margin: 1.5rem 0;
        }
        .result-box .label { opacity: 0.9; margin-bottom: 0.5rem; }
        .result-box .total { font-size: 3rem; font-weight: bold; font-family: 'Economica', sans-serif; }
        .result-box .sub { font-size: 1rem; opacity: 0.9; margin-top: 0.5rem; }

        .breakdown-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .breakdown-card h3 { color: var(--primary-color); margin-bottom: 1rem; font-size: 1.1rem; }
        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }
        .breakdown-row:last-child { border-bottom: none; }
        .breakdown-row .label { color: var(--text-color); }
        .breakdown-row .value { font-weight: 600; font-family: 'Economica', sans-serif; font-size: 1.1rem; }
        .breakdown-row.total {
            font-weight: bold;
            background: var(--light-bg);
            margin: 0.5rem -1.5rem -1.5rem;
            padding: 1rem 1.5rem;
            border-radius: 0 0 12px 12px;
        }
        .breakdown-row.total .value { color: var(--primary-color); }

        .fitness-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .fitness-btn {
            flex: 1;
            min-width: 100px;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }
        .fitness-btn:hover { border-color: var(--primary-color); }
        .fitness-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        .fitness-btn .icon { font-size: 1.5rem; margin-bottom: 0.25rem; }
        .fitness-btn .name { font-weight: 600; font-size: 0.9rem; }

        .input-with-unit {
            position: relative;
        }
        .input-with-unit input {
            padding-right: 3rem;
        }
        .input-with-unit .unit {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-color);
            opacity: 0.6;
            font-size: 0.9rem;
        }

        .share-buttons { display: flex; gap: 0.5rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap; }
        .share-btn { padding: 0.75rem 1.25rem; border-radius: 8px; border: none; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
        .share-btn.primary { background: var(--primary-color); color: white; }
        .share-btn.copy { background: var(--secondary-color); color: white; }
        .share-btn:hover { transform: translateY(-2px); }

        .tip-card {
            background: linear-gradient(135deg, #2d5a27, #4a7c43);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            margin: 1.5rem 0;
        }
        .tip-card h4 { margin: 0 0 0.75rem 0; }
        .tip-card ul { margin: 0; padding-left: 1.25rem; }
        .tip-card li { margin-bottom: 0.5rem; opacity: 0.9; }

        .difficulty-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-weight: 600;
        }
        .difficulty-indicator.easy { background: #d4edda; color: #155724; }
        .difficulty-indicator.moderate { background: #fff3cd; color: #856404; }
        .difficulty-indicator.hard { background: #f8d7da; color: #721c24; }
        .difficulty-indicator.expert { background: #d1c4e9; color: #4a148c; }
    </style>
</head>
<body>
    <div class="container">
        {{ partial "header.html" . }}

        {{ partial "page-header.html" . }}

        <nav class="tool-nav">
            <a href="{{ "" | relLangURL }}">{{ i18n "allTools" }}</a>
        </nav>

        <div class="steps-container">
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-route"></i>
                    <div class="step-number">1</div>
                </div>
                <div class="step-content">
                    <h3>{{ i18n "hiking.step1Title" }}</h3>
                    <p>{{ i18n "hiking.step1Desc" }}</p>
                </div>
            </div>
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-heart"></i>
                    <div class="step-number">2</div>
                </div>
                <div class="step-content">
                    <h3>{{ i18n "hiking.step2Title" }}</h3>
                    <p>{{ i18n "hiking.step2Desc" }}</p>
                </div>
            </div>
            <div class="step-card">
                <div class="step-icon">
                    <i class="fas fa-clock"></i>
                    <div class="step-number">3</div>
                </div>
                <div class="step-content">
                    <h3>{{ i18n "hiking.step3Title" }}</h3>
                    <p>{{ i18n "hiking.step3Desc" }}</p>
                </div>
            </div>
        </div>

        <div class="calculator-card">
            <div class="form-group">
                <label for="distance">{{ i18n "hiking.distance" }}</label>
                <div class="input-with-unit">
                    <input type="number" id="distance" value="12" min="0" step="0.1" oninput="calculate()">
                    <span class="unit">{{ i18n "hiking.km" }}</span>
                </div>
            </div>

            <div class="form-group">
                <label for="elevationUp">{{ i18n "hiking.elevationUp" }}</label>
                <div class="input-with-unit">
                    <input type="number" id="elevationUp" value="800" min="0" step="50" oninput="calculate()">
                    <span class="unit">{{ i18n "hiking.meters" }}</span>
                </div>
            </div>

            <div class="form-group">
                <label for="elevationDown">{{ i18n "hiking.elevationDown" }}</label>
                <div class="input-with-unit">
                    <input type="number" id="elevationDown" value="800" min="0" step="50" oninput="calculate()">
                    <span class="unit">{{ i18n "hiking.meters" }}</span>
                </div>
            </div>

            <div class="form-group">
                <label>{{ i18n "hiking.fitnessLevel" }}</label>
                <div class="fitness-selector">
                    <button type="button" class="fitness-btn" data-fitness="slow" onclick="setFitness('slow')">
                        <div class="icon">üê¢</div>
                        <div class="name">{{ i18n "hiking.leisurely" }}</div>
                    </button>
                    <button type="button" class="fitness-btn active" data-fitness="normal" onclick="setFitness('normal')">
                        <div class="icon">üö∂</div>
                        <div class="name">{{ i18n "hiking.normal" }}</div>
                    </button>
                    <button type="button" class="fitness-btn" data-fitness="fast" onclick="setFitness('fast')">
                        <div class="icon">üèÉ</div>
                        <div class="name">{{ i18n "hiking.sporty" }}</div>
                    </button>
                </div>
            </div>
        </div>

        <div id="results">
            <div class="result-box">
                <div class="label">{{ i18n "hiking.estimatedHikingTime" }}</div>
                <div class="total" id="totalTime">3h 45min</div>
                <div class="sub" id="totalSub">{{ i18n "hiking.pureWalkingTime" }}</div>
            </div>

            <div id="difficultyIndicator" class="difficulty-indicator moderate">
                <i class="fas fa-mountain"></i>
                <span id="difficultyText">{{ i18n "hiking.moderateHike" }}</span>
            </div>

            <div class="breakdown-card">
                <h3><i class="fas fa-calculator"></i> {{ i18n "hiking.calculation" }}</h3>
                <div class="breakdown-row">
                    <span class="label">{{ i18n "hiking.horizontalTime" }}</span>
                    <span class="value" id="timeHorizontal">3h 00min</span>
                </div>
                <div class="breakdown-row">
                    <span class="label">{{ i18n "hiking.ascentTime" }}</span>
                    <span class="value" id="timeUp">2h 00min</span>
                </div>
                <div class="breakdown-row">
                    <span class="label">{{ i18n "hiking.descentTime" }}</span>
                    <span class="value" id="timeDown">1h 00min</span>
                </div>
                <div class="breakdown-row">
                    <span class="label">{{ i18n "hiking.performanceKm" }}</span>
                    <span class="value" id="lkm">20 LKM</span>
                </div>
                <div class="breakdown-row total">
                    <span class="label">{{ i18n "hiking.pureWalkingTimeLabel" }}</span>
                    <span class="value" id="pureTime">3h 45min</span>
                </div>
            </div>

            <div class="breakdown-card">
                <h3><i class="fas fa-coffee"></i> {{ i18n "hiking.withBreaks" }}</h3>
                <div class="breakdown-row">
                    <span class="label">{{ i18n "hiking.recommendedBreakTime" }}</span>
                    <span class="value" id="breakTime">45min</span>
                </div>
                <div class="breakdown-row total">
                    <span class="label">{{ i18n "hiking.totalTimeWithBreaks" }}</span>
                    <span class="value" id="totalWithBreaks">4h 30min</span>
                </div>
            </div>

            <div class="share-buttons">
                <button class="share-btn primary" onclick="shareResult()">
                    <i class="fas fa-share-alt"></i> {{ i18n "share" }}
                </button>
                <button class="share-btn copy" onclick="copyResult()">
                    <i class="fas fa-copy"></i> {{ i18n "copy" }}
                </button>
            </div>
        </div>

        <div class="tip-card">
            <h4><i class="fas fa-lightbulb"></i> {{ i18n "hiking.tipsTitle" }}</h4>
            <ul>
                <li><strong>{{ i18n "hiking.tip1Label" }}:</strong> {{ i18n "hiking.tip1Text" }}</li>
                <li><strong>{{ i18n "hiking.tip2Label" }}:</strong> {{ i18n "hiking.tip2Text" }}</li>
                <li><strong>{{ i18n "hiking.tip3Label" }}:</strong> {{ i18n "hiking.tip3Text" }}</li>
                <li><strong>{{ i18n "hiking.tip4Label" }}:</strong> {{ i18n "hiking.tip4Text" }}</li>
            </ul>
        </div>

        {{ .Content }}

        <div class="info-cards-container" style="margin-top: 2rem;">
            <div class="info-step-card" style="grid-column: 1 / -1;">
                <div class="step-icon"><i class="fas fa-link"></i></div>
                <div class="step-content">
                    <h3>{{ i18n "hiking.usefulLinks" }}</h3>
                    <ul style="margin: 0.5rem 0; list-style: none; padding: 0;">
                        <li style="margin-bottom: 0.5rem;"><a href="{{ i18n "hiking.link1Url" }}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt"></i> {{ i18n "hiking.link1Text" }}</a></li>
                        <li style="margin-bottom: 0.5rem;"><a href="{{ i18n "hiking.link2Url" }}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt"></i> {{ i18n "hiking.link2Text" }}</a></li>
                        <li style="margin-bottom: 0.5rem;"><a href="{{ i18n "hiking.link3Url" }}" target="_blank" rel="noopener"><i class="fas fa-external-link-alt"></i> {{ i18n "hiking.link3Text" }}</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    {{ partial "footer.html" . }}

    <script>
        // Fitness multipliers
        const FITNESS = {
            slow: { speed: 3.5, upSpeed: 350, downSpeed: 700, label: '{{ i18n "hiking.leisurely" }}' },
            normal: { speed: 4.0, upSpeed: 400, downSpeed: 800, label: '{{ i18n "hiking.normal" }}' },
            fast: { speed: 5.0, upSpeed: 500, downSpeed: 1000, label: '{{ i18n "hiking.sporty" }}' }
        };

        let currentFitness = 'normal';

        function setFitness(level) {
            currentFitness = level;
            document.querySelectorAll('.fitness-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.fitness === level);
            });
            calculate();
        }

        function calculate() {
            const distance = parseFloat(document.getElementById('distance').value) || 0;
            const elevationUp = parseFloat(document.getElementById('elevationUp').value) || 0;
            const elevationDown = parseFloat(document.getElementById('elevationDown').value) || 0;

            const fitness = FITNESS[currentFitness];

            // Time calculations in hours
            const timeHorizontal = distance / fitness.speed;
            const timeUp = elevationUp / fitness.upSpeed;
            const timeDown = elevationDown / fitness.downSpeed;

            // Swiss formula: add smaller half to larger
            const verticalTime = timeUp + timeDown;
            let totalTime;
            if (timeHorizontal > verticalTime) {
                totalTime = timeHorizontal + (verticalTime / 2);
            } else {
                totalTime = verticalTime + (timeHorizontal / 2);
            }

            // Leistungskilometer: 1 LKM = 1km = 100Hm
            const lkm = distance + (elevationUp / 100);

            // Recommended break time (10-15 min per hour)
            const breakTime = totalTime * 0.2; // 12 min per hour on average

            // Total with breaks
            const totalWithBreaks = totalTime + breakTime;

            // Difficulty assessment based on LKM and elevation
            let difficulty, difficultyText, difficultyClass;
            if (lkm <= 10 && elevationUp <= 500) {
                difficulty = 'easy';
                difficultyText = '{{ i18n "hiking.easyHike" }}';
                difficultyClass = 'easy';
            } else if (lkm <= 18 && elevationUp <= 1000) {
                difficulty = 'moderate';
                difficultyText = '{{ i18n "hiking.moderateHike" }}';
                difficultyClass = 'moderate';
            } else if (lkm <= 25 && elevationUp <= 1500) {
                difficulty = 'hard';
                difficultyText = '{{ i18n "hiking.demandingHike" }}';
                difficultyClass = 'hard';
            } else {
                difficulty = 'expert';
                difficultyText = '{{ i18n "hiking.veryDemandingHike" }}';
                difficultyClass = 'expert';
            }

            // Update UI
            document.getElementById('totalTime').textContent = formatTime(totalTime);
            document.getElementById('totalSub').textContent = '{{ i18n "hiking.pureWalkingTimeSub" }}'.replace('{fitness}', FITNESS[currentFitness].label);

            document.getElementById('timeHorizontal').textContent = formatTime(timeHorizontal);
            document.getElementById('timeUp').textContent = formatTime(timeUp);
            document.getElementById('timeDown').textContent = formatTime(timeDown);
            document.getElementById('lkm').textContent = lkm.toFixed(1) + ' LKM';
            document.getElementById('pureTime').textContent = formatTime(totalTime);

            document.getElementById('breakTime').textContent = formatTime(breakTime);
            document.getElementById('totalWithBreaks').textContent = formatTime(totalWithBreaks);

            const diffIndicator = document.getElementById('difficultyIndicator');
            diffIndicator.className = 'difficulty-indicator ' + difficultyClass;
            document.getElementById('difficultyText').textContent = difficultyText;
        }

        function formatTime(hours) {
            const h = Math.floor(hours);
            const m = Math.round((hours - h) * 60);
            if (h === 0) return m + 'min';
            if (m === 0) return h + 'h';
            return h + 'h ' + m.toString().padStart(2, '0') + 'min';
        }

        function getShareText() {
            const distance = document.getElementById('distance').value;
            const elevationUp = document.getElementById('elevationUp').value;
            const totalTime = document.getElementById('totalTime').textContent;
            const totalWithBreaks = document.getElementById('totalWithBreaks').textContent;
            return `{{ i18n "hiking.shareText" }}`.replace('{distance}', distance).replace('{elevation}', elevationUp).replace('{time}', totalTime).replace('{totalTime}', totalWithBreaks) + '\n\n{{ i18n "hiking.shareUrl" }}';
        }

        function shareResult() {
            const shareData = { title: document.title, text: getShareText(), url: window.location.href };
            if (navigator.share && navigator.canShare && navigator.canShare(shareData)) {
                navigator.share(shareData).catch(() => {});
            } else {
                window.open('https://wa.me/?text=' + encodeURIComponent(getShareText()), '_blank');
            }
        }

        function copyResult() {
            navigator.clipboard.writeText(getShareText()).then(() => {
                const btn = document.querySelector('.share-btn.copy');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> {{ i18n "copied" }}';
                setTimeout(() => btn.innerHTML = originalText, 2000);
            });
        }

        {{ partial "darkmode.html" . }}

        DarkMode.init();
        calculate();
    </script>
</body>
</html>
