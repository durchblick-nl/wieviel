<!DOCTYPE html>
<html lang="{{ .Site.Language.Lang }}">
<head>
    {{- partial "head.html" . }}
    <style>
        .absence-type { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 0.75rem; margin: 1rem 0; }
        .absence-btn { padding: 1rem; border-radius: 12px; border: 2px solid var(--border-color); background: var(--card-bg); cursor: pointer; text-align: center; transition: all 0.2s; color: var(--text-color); }
        .absence-btn:hover { border-color: var(--primary-color); }
        .absence-btn.active { border-color: var(--primary-color); background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .absence-btn i { font-size: 1.5rem; display: block; margin-bottom: 0.5rem; }
        .absence-btn:not(.active) i { color: var(--primary-color); }
        .absence-btn.active i { color: white; }
        .absence-btn span { font-size: 0.85rem; font-weight: 600; }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 1rem 0; }
        .input-group { display: flex; flex-direction: column; gap: 0.5rem; }
        .input-group label { font-weight: 600; color: var(--text-color); }
        .input-group input, .input-group select { padding: 0.75rem; border: 2px solid var(--border-color); border-radius: 8px; font-size: 1rem; background: var(--input-bg); color: var(--text-color); }
        .input-group small { color: var(--text-color); opacity: 0.7; font-size: 0.85rem; }
        .result-box { padding: 2rem; border-radius: 16px; text-align: center; margin: 1.5rem 0; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white; }
        .result-box .main-result { font-size: 3.5rem; font-weight: bold; font-family: 'Economica', sans-serif; line-height: 1; }
        .result-box .main-result small { font-size: 1.25rem; }
        .result-box .sub-result { font-size: 1.1rem; margin-top: 0.5rem; opacity: 0.9; }
        .calculation-card { background: var(--light-bg); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.25rem; margin: 1rem 0; }
        .calculation-card h4 { margin: 0 0 1rem 0; color: var(--primary-color); }
        .calc-row { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-color); }
        .calc-row:last-child { border-bottom: none; }
        .calc-row.total { font-weight: bold; border-top: 2px solid var(--primary-color); padding-top: 0.75rem; margin-top: 0.5rem; }
        .calc-row .negative { color: var(--accent-color); }
        .info-note { background: rgba(63, 96, 111, 0.1); border-left: 4px solid var(--primary-color); padding: 1rem; border-radius: 0 8px 8px 0; margin: 1rem 0; font-size: 0.9rem; }
        .share-buttons { display: flex; gap: 0.5rem; justify-content: center; margin-top: 1.5rem; flex-wrap: wrap; }
        .share-btn { padding: 0.75rem 1.25rem; border-radius: 8px; border: none; cursor: pointer; font-size: 0.9rem; display: flex; align-items: center; gap: 0.5rem; transition: all 0.2s; }
        .share-btn.primary { background: var(--primary-color); color: white; }
        .share-btn.copy { background: var(--secondary-color); color: white; }
        @media (max-width: 480px) { .input-row { grid-template-columns: 1fr; } .result-box .main-result { font-size: 2.5rem; } }
    </style>
</head>
<body>
    <div class="container">
        {{- partial "header.html" . }}
        {{- partial "page-header.html" . }}

        <div class="steps-container">
            <div class="step-card">
                <div class="step-icon"><i class="fas fa-calendar-alt"></i><div class="step-number">1</div></div>
                <div class="step-content"><h3>{{ i18n "vacation.step1Title" }}</h3><p>{{ i18n "vacation.step1Desc" }}</p></div>
            </div>
            <div class="step-card">
                <div class="step-icon"><i class="fas fa-user-clock"></i><div class="step-number">2</div></div>
                <div class="step-content"><h3>{{ i18n "vacation.step2Title" }}</h3><p>{{ i18n "vacation.step2Desc" }}</p></div>
            </div>
            <div class="step-card">
                <div class="step-icon"><i class="fas fa-calculator"></i><div class="step-number">3</div></div>
                <div class="step-content"><h3>{{ i18n "vacation.step3Title" }}</h3><p>{{ i18n "vacation.step3Desc" }}</p></div>
            </div>
        </div>

        <div class="calculator-card">
            <div class="input-row">
                <div class="input-group">
                    <label for="vacationDays">{{ i18n "vacation.annualEntitlement" }}</label>
                    <input type="number" id="vacationDays" value="20" min="4" max="60" oninput="calculate()">
                    <small>{{ i18n "vacation.minLegal" }}</small>
                </div>
                <div class="input-group">
                    <label for="absenceMonths">{{ i18n "vacation.absenceDuration" }}</label>
                    <select id="absenceMonths" onchange="calculate()">
                        <option value="1">1 {{ i18n "vacation.month" }}</option>
                        <option value="2">2 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="3" selected>3 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="4">4 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="5">5 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="6">6 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="7">7 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="8">8 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="9">9 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="10">10 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="11">11 {{ i18n "vacation.monthsPlural" }}</option>
                        <option value="12">12 {{ i18n "vacation.monthsPlural" }}</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label>{{ i18n "vacation.absenceReason" }}</label>
                <div class="absence-type">
                    <button type="button" class="absence-btn active" data-type="illness" onclick="setAbsenceType('illness')">
                        <i class="fas fa-briefcase-medical"></i>
                        <span>{{ i18n "vacation.illness" }}</span>
                    </button>
                    <button type="button" class="absence-btn" data-type="pregnancy" onclick="setAbsenceType('pregnancy')">
                        <i class="fas fa-baby"></i>
                        <span>{{ i18n "vacation.pregnancy" }}</span>
                    </button>
                    <button type="button" class="absence-btn" data-type="military" onclick="setAbsenceType('military')">
                        <i class="fas fa-shield-alt"></i>
                        <span>{{ i18n "vacation.military" }}</span>
                    </button>
                    <button type="button" class="absence-btn" data-type="unpaid" onclick="setAbsenceType('unpaid')">
                        <i class="fas fa-pause-circle"></i>
                        <span>{{ i18n "vacation.unpaidLeave" }}</span>
                    </button>
                </div>
            </div>

            <div id="result">
                <div class="result-box">
                    <div class="main-result"><span id="remainingDays">20</span> <small>{{ i18n "vacation.daysLabel" }}</small></div>
                    <div class="sub-result" id="resultSubtext">{{ i18n "vacation.remainingEntitlement" }}</div>
                </div>

                <div class="calculation-card">
                    <h4><i class="fas fa-calculator"></i> {{ i18n "vacation.calculation" }}</h4>
                    <div class="calc-row">
                        <span>{{ i18n "vacation.entitlement" }}</span>
                        <span id="calcBase">20 {{ i18n "vacation.daysLabel" }}</span>
                    </div>
                    <div class="calc-row">
                        <span>{{ i18n "vacation.absence" }}</span>
                        <span id="calcAbsence">3 {{ i18n "vacation.monthsPlural" }}</span>
                    </div>
                    <div class="calc-row">
                        <span>{{ i18n "vacation.freeMonths" }}</span>
                        <span id="calcFreeMonths">1 {{ i18n "vacation.month" }}</span>
                    </div>
                    <div class="calc-row">
                        <span>{{ i18n "vacation.reducibleMonths" }}</span>
                        <span id="calcReduceMonths">2 {{ i18n "vacation.monthsPlural" }}</span>
                    </div>
                    <div class="calc-row">
                        <span>{{ i18n "vacation.reductionPerMonth" }}</span>
                        <span id="calcPerMonth">1.67 {{ i18n "vacation.daysLabel" }}</span>
                    </div>
                    <div class="calc-row">
                        <span class="negative">{{ i18n "vacation.totalReduction" }}</span>
                        <span class="negative" id="calcReduction">âˆ’3.33 {{ i18n "vacation.daysLabel" }}</span>
                    </div>
                    <div class="calc-row total">
                        <span>{{ i18n "vacation.remaining" }}</span>
                        <span id="calcRemaining">16.67 {{ i18n "vacation.daysLabel" }}</span>
                    </div>
                </div>

                <div class="info-note" id="infoNote">
                    <i class="fas fa-info-circle"></i>
                    <strong>{{ i18n "vacation.note" }}:</strong> {{ i18n "vacation.illnessNote" }}
                </div>

                <div class="share-buttons">
                    <button class="share-btn primary" onclick="shareResult()"><i class="fas fa-share-alt"></i> {{ i18n "share" }}</button>
                    <button class="share-btn copy" onclick="copyResult()"><i class="fas fa-copy"></i> {{ i18n "copy" }}</button>
                </div>
            </div>
        </div>

        {{ .Content }}
    </div>

    {{- partial "footer.html" . }}
    {{- partial "darkmode.html" . }}

    <script>
        const LANG = '{{ .Site.Language.Lang }}';
        const TEXTS = {
            copied: '{{ i18n "copied" }}',
            copy: '{{ i18n "copy" }}',
            days: '{{ i18n "vacation.daysLabel" }}',
            month: '{{ i18n "vacation.month" }}',
            months: '{{ i18n "vacation.monthsPlural" }}',
            noReduction: '{{ i18n "vacation.noReduction" }}',
            reducedBy: '{{ i18n "vacation.reducedBy" }}',
            illnessNote: '{{ i18n "vacation.illnessNote" }}',
            pregnancyNote: '{{ i18n "vacation.pregnancyNote" }}',
            militaryNote: '{{ i18n "vacation.militaryNote" }}',
            unpaidNote: '{{ i18n "vacation.unpaidNote" }}',
            shareUrl: LANG === 'de' ? 'https://wieviel.ch/ferienkuerzung/' : 'https://calcule.ch/reduction-vacances/'
        };

        let absenceType = 'illness';
        const FREE_MONTHS = { 'illness': 1, 'pregnancy': 2, 'military': 0, 'unpaid': 0 };

        function setAbsenceType(type) {
            absenceType = type;
            document.querySelectorAll('.absence-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.type === type));
            calculate();
        }

        function calculate() {
            const vacationDays = parseFloat(document.getElementById('vacationDays').value) || 20;
            const absenceMonths = parseInt(document.getElementById('absenceMonths').value) || 0;
            const freeMonths = FREE_MONTHS[absenceType];
            const reducibleMonths = Math.max(0, absenceMonths - freeMonths);
            const reductionPerMonth = vacationDays / 12;
            const totalReduction = reducibleMonths * reductionPerMonth;
            const remainingDays = Math.max(0, vacationDays - totalReduction);

            document.getElementById('remainingDays').textContent = remainingDays.toFixed(1).replace('.0', '');
            document.getElementById('resultSubtext').textContent = totalReduction > 0
                ? TEXTS.reducedBy + ' ' + totalReduction.toFixed(1) + ' ' + TEXTS.days
                : TEXTS.noReduction;

            document.getElementById('calcBase').textContent = vacationDays + ' ' + TEXTS.days;
            document.getElementById('calcAbsence').textContent = absenceMonths + ' ' + (absenceMonths === 1 ? TEXTS.month : TEXTS.months);
            document.getElementById('calcFreeMonths').textContent = freeMonths + ' ' + (freeMonths === 1 ? TEXTS.month : TEXTS.months);
            document.getElementById('calcReduceMonths').textContent = reducibleMonths + ' ' + (reducibleMonths === 1 ? TEXTS.month : TEXTS.months);
            document.getElementById('calcPerMonth').textContent = reductionPerMonth.toFixed(2) + ' ' + TEXTS.days;
            document.getElementById('calcReduction').textContent = totalReduction > 0 ? 'âˆ’' + totalReduction.toFixed(2) + ' ' + TEXTS.days : '0 ' + TEXTS.days;
            document.getElementById('calcRemaining').textContent = remainingDays.toFixed(2) + ' ' + TEXTS.days;

            const notes = { illness: TEXTS.illnessNote, pregnancy: TEXTS.pregnancyNote, military: TEXTS.militaryNote, unpaid: TEXTS.unpaidNote };
            document.getElementById('infoNote').innerHTML = '<i class="fas fa-info-circle"></i> <strong>{{ i18n "vacation.note" }}:</strong> ' + notes[absenceType];
        }

        function getShareText() {
            const vacationDays = document.getElementById('vacationDays').value;
            const absenceMonths = document.getElementById('absenceMonths').value;
            const remaining = document.getElementById('remainingDays').textContent;
            return LANG === 'de'
                ? `ðŸ–ï¸ FerienkÃ¼rzung Rechner\n\nFerienanspruch: ${vacationDays} Tage\nAbwesenheit: ${absenceMonths} Monate\nVerbleibend: ${remaining} Tage\n\n${TEXTS.shareUrl}`
                : `ðŸ–ï¸ Calculateur rÃ©duction vacances\n\nDroit aux vacances: ${vacationDays} jours\nAbsence: ${absenceMonths} mois\nRestant: ${remaining} jours\n\n${TEXTS.shareUrl}`;
        }

        function shareResult() {
            const shareData = { title: document.title, text: getShareText(), url: window.location.href };
            if (navigator.share && navigator.canShare && navigator.canShare(shareData)) navigator.share(shareData).catch(() => {});
            else window.open('https://wa.me/?text=' + encodeURIComponent(getShareText()), '_blank');
        }

        function copyResult() {
            navigator.clipboard.writeText(getShareText()).then(() => {
                const btn = document.querySelector('.share-btn.copy');
                btn.innerHTML = '<i class="fas fa-check"></i> ' + TEXTS.copied;
                setTimeout(() => btn.innerHTML = '<i class="fas fa-copy"></i> ' + TEXTS.copy, 2000);
            });
        }

        calculate();
    </script>
</body>
</html>
